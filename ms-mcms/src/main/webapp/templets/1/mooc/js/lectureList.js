(function(){define("lib/m",[],function(){"use strict";var e=!!document.all&&navigator.userAgent.indexOf("Opera")===-1,t=e&&!("maxHeight"in document.body.style),n=e&&"prototype"in Image,r=e&&!t&&!n,i=window,s=i.document;return{ua:{isIE:e,isIE6:t,isIE8:n,isIE7:r,isFF:!!s.getBoxObjectFor||"mozInnerScreenX"in i,isOP:!!i.opera&&!!i.opera.toString().indexOf("Opera"),isOP9:/^function \(/.test([].sort),isWK:!!i.devicePixelRatio,isSF:/a/.__proto__=="//",isCR:/s/.test(/a/.toString)},scriptOnload:function(e,t){this.ua.isIE?e.attachEvent("onreadystatechange",function(){var n=e.readyState;(n==="loaded"||n==="complete")&&t()}):(e.addEventListener("load",t,!1),e.addEventListener("error",function(){t()},!1))},loadScript:function(e,t){var n=s.createElement("script"),r=this.loadScript.head=this.loadScript.head||s.getElementsByTagName("head")[0];return this.scriptOnload(n,function(){t&&t.call(n);try{if(n.clearAttributes)n.clearAttributes();else for(var e in n)delete n[e]}catch(i){}r.removeChild(n)}),n.async=!0,n.src=e,r.insertBefore(n,r.firstChild)},isHtml:function(e){var t=/^[^<]*(<[\w\W]+>)[^>]*$/;return t.test(e)},format:function(e,t,n){if(typeof t=="string"){var r=n?t:"{v}",i=n||t;return e.replace(r,""+i)}var s=t,i;return e.replace(/\{([^{}]+)\}/g,function(e,t){return i=s[t],i!==undefined?""+i:""})}}}),define("lib/JSON2",function(){"use strict";function f(e){return e<10?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o=gap,u,a=t[e];a&&typeof a=="object"&&typeof a.toJSON=="function"&&(a=a.toJSON(e)),typeof rep=="function"&&(a=rep.call(t,e,a));switch(typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";gap+=indent,u=[];if(Object.prototype.toString.apply(a)==="[object Array]"){s=a.length;for(n=0;n<s;n+=1)u[n]=str(n,a)||"null";return i=u.length===0?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+o+"]":"["+u.join(",")+"]",gap=o,i}if(rep&&typeof rep=="object"){s=rep.length;for(n=0;n<s;n+=1)typeof rep[n]=="string"&&(r=rep[n],i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i))}else for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i));return i=u.length===0?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+o+"}":"{"+u.join(",")+"}",gap=o,i}}window.JSON||(window.JSON={}),typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(e,t,n){var r;gap="",indent="";if(typeof n=="number")for(r=0;r<n;r+=1)indent+=" ";else typeof n=="string"&&(indent=n);rep=t;if(!t||typeof t=="function"||typeof t=="object"&&typeof t.length=="number")return str("",{"":e});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&typeof i=="object")for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r=walk(i,n),r!==undefined?i[n]=r:delete i[n]);return reviver.call(e,t,i)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}()),define("lib/JSON2",function(){}),define("lib/store",["lib/JSON2"],function(){function e(){var e="test",t=window.localStorage;try{return t.setItem(e,"1"),t.removeItem(e),"localStorage"in window}catch(n){return!1}}var t=e(),n={set:function(){},get:function(){},remove:function(){},clear:function(){},isSupport:!1};if(t){var r=window.localStorage,i=function(e,t){var n=r[e];return function(i){setTimeout(function(){i=i||window.storageEvent;var s=i.key,o=i.newValue;if(!s){var u=r[e];u!=n&&(s=e,o=u)}s==e&&(t&&t(o==null?null:JSON.parse(o)),n=o)},0)}};n.set=function(e,t){r.setItem(e,JSON.stringify(t))},n.get=function(e){var t=r.getItem(e),i=t==null?null:JSON.parse(t);return i!==null&&i.date&&i.expiredDate&&n._expired(e,i.expiredDate,i.date)&&(i=null),i},n.remove=function(e){r.removeItem(e)},n.clear=function(){r.clear()},n.onStorage=function(e,t){window.addEventListener?window.addEventListener("storage",i(e,t),!1):document.attachEvent("storage",i(e,t))},n._expired=function(e,t,r){return(new Date).getTime()-r>=t*864e5?(n.remove(e),!0):!1},n.isSupport=!0}else/MSIE ([^;]+)/.test(navigator.userAgent)&&(n={o:null,defExps:365,init:function(){if(!n.o)try{n.o=document.createElement("input"),n.o.type="hidden",n.o.addBehavior("#default#userData"),document.body.appendChild(n.o)}catch(e){return!1}return!0},set:function(e,t,r){if(n.init()){var i=n.o;i.load(e),t&&i.setAttribute("code",JSON.stringify(t));var s=new Date,r=r?r:n.defExps;s.setDate(s.getDate()+r),i.expires=s.toUTCString(),i.save(e)}},get:function(e){if(n.init()){var t=n.o;return t.load(e),typeof t.getAttribute("code")=="undefined"?null:JSON.parse(t.getAttribute("code"))}},onStorage:function(){},remove:function(e){n.set(e,!1,-365)},isSupport:!0});return n}),define("lib/user",["lib/store"],function(e){function n(n,i){if(!window.ukey)return n(null);var s=r();!s||window.ukey!=s.ukey?$.getJSON("/_csi/user/info.json").done(function(r){r.ok&&(e.isSupport&&e.set(t,r.result),n(r.result))}).fail(function(){i&i()}):n(s)}function r(){e.get(t)}function i(){e.remove(t)}var t="CURRENT_USER_CACHE_KEY";return{getCurrent:n,getUserCache:r,clearUserCache:i,isLogin:function(){return typeof ukey=="undefined"&&(ukey=!1),ukey?!0:!1},toLogin:function(e){document.location.href=e}}}),define("lib/support",["lib/m"],function(e){"use strict";var t=" -webkit- -moz- -o- -ms- -khtml- ".split(" "),n="Webkit Moz O ms Khtml".split(" "),r=document.createElement("div");return{fixed:function i(){if(typeof i.r!="undefined")return i.r;var t=!0;if(e.ua.isIpad||e.ua.isIphone)t=navigator.userAgent.match(/[5-9]_[0-9]/)!==null;else{var n=document.createElement("div"),r=document.createElement("div");n.style.position="absolute",n.style.top="200px",r.style.position="fixed",r.style.top="100px",n.appendChild(r),document.body.appendChild(n),r.getBoundingClientRect&&r.getBoundingClientRect().top==n.getBoundingClientRect().top&&(t=!1),document.body.removeChild(n),n=null,r=null}return i.r=t,t},touchEvent:function s(){if(typeof s.r!="undefined")return s.r;var e=!0,t=["touchstart","touchmove","touchend","touchcancel"];for(var n=0,i=t.length;n<i;n++){var o=t[n];o="on"+o;var u=o in r;u||(r.setAttribute(o,"return;"),u=typeof r[o]=="function");if(!u){e=!1;break}}return s.r=e,e},cssanimation:function o(){if(typeof o.r!="undefined")return o.r;var e=!1,t=r.style,i="animationName",s=i.charAt(0).toUpperCase()+i.substr(1),u=(i+" "+n.join(s+" ")+s).split(" ");for(var a in u)if(t[u[a]]!==undefined){e=!0;break}return o.r=e,e}}}),define("lib/Base",[],function(){"use strict";var e=function(){};return e.extend=function(e,t){var n=t||this;for(var r in n)n.hasOwnProperty(r)&&r!=="prototype"&&(e[r]=n[r]);for(var i in n.prototype)n.prototype.hasOwnProperty(i)&&(e.prototype[i]=n.prototype[i])},e}),define("lib/Event",["lib/Base"],function(e){"use strict";function o(){}var t=Array.prototype.slice,n=Object.prototype.toString,r=function(e){return typeof e=="object"?e===null?"null":/\[object (\w+)\]/.exec(n.call(e))[1].toLowerCase():typeof e},i=function(e,t,n){var i,s,o,u=Array.prototype.forEach;n=n||this;if(e==null)return;if(u&&e.forEach===u)e.forEach(t,n);else if(r(e)==="array")for(s=0,o=e.length;s<o;s++)t.call(n,e[s],s,e);else for(var a in e)ObjectProto.hasOwnProperty.call(e,a)&&t.call(n,e[a],a,e)},s=function(e,t,n){var i,s,o,u,a=Array.prototype.filter;n=n||this;if(e==null)return;if(a&&e.filter===a)return e.filter(t,n);if(r(e)==="array"){u=[];for(s=0,o=e.length;s<o;s++)t.call(n,e[s],s,e)&&u.push(e[s])}else{u={};for(var f in e)ObjectProto.hasOwnProperty.call(e,f)&&t.call(n,e[f],f,e)&&(u[f]=e[f])}return u};return o.prototype.on=function(e,t,n,r){return this.eventQueue=this.eventQueue||{},this.eventQueue[e]=this.eventQueue[e]||[],this.eventQueue[e].push({callback:t,context:n,once:r}),this},o.prototype.off=function(e,t){this.eventQueue=this.eventQueue||{};if(this.eventQueue[e]==null)return;return t?(this.eventQueue[e]=s(this.eventQueue[e],function(e,n){return e.callback!==t}),this.eventQueue[e].length===0&&delete this.eventQueue[e]):delete this.eventQueue[e],this},o.prototype.fire=function(e,n){this.eventQueue=this.eventQueue||{};var r=this.eventQueue[e],s=!0;if(r){var o=t.call(arguments,1);i(r,function(t){t.callback.apply(t.context,o)===!1&&(s=!1),t.once&&this.off(e,t.callback)},this)}return s},e.extend(o),o}),define("lib/Overlay",["lib/support","lib/Event","lib/m"],function(e,t,n){"use strict";function y(e){var t,n;e?(t=(u.height()-h.height())/2+(document.documentElement.scrollTop||window.pageYOffset||0),n=(u.width()-h.width())/2+(document.documentElement.scrollLeft||window.pageXOffset||0)):(t=(u.height()-h.height())/2,n=(u.width()-h.width())/2),h.css({top:t,left:n})}function b(e,t){v&&v.length&&v.css({opacity:e||.5,"background-color":t||"#000"}).show()}function w(){v&&v.length&&v.remove()}function E(){v.css({top:document.documentElement.scrollTop||window.pageYOffset||0,left:document.documentElement.scrollLeft||window.pageXOffset||0})}function S(){v.css({width:u.width(),height:u.height()})}function x(t){i=t,s='<div id="blockWindow" class="'+i+'-block">                           <div class="'+i+'-block-b">                               <h4 class="'+i+'-block-hd">                                   <span id="blockTitle"></span>                                   <a id="blockClose" class="block-close" href="#" title="关闭">X</a>                               </h4>                               <div id="blockContent" class="'+i+'-block-bd"></div>                           </div>                       </div>',h=$(s),h.appendTo("body"),p=$(a),d=$(f),g=[h,p],navigator.userAgent.match(/iPad|iPhone/i)!==null?c=navigator.userAgent.match(/[5-9]_[0-9]/)!==null:(c=e.fixed(),u.resize(function(){m&&m.pos()})),h.delegate(l,"click",function(e){e.preventDefault(),m&&m.close()})}function T(e,t,n,r){this._isOpen=!1,x.call(this,r),this._fixed=c,e&&!r&&this.open(e,t,n)}var r=0,i,s,o='<iframe src="{v}" id="blockIframe" class="block-iframe" frameborder="0" width="100%"></iframe>',u=$(window),a="#blockContent",f="#blockTitle",l="#blockClose",c,h,p,d,v,m,g;return T.prototype={openCallBack:function(e){return e&&this.on("open",e,this),this},closeCallBack:function(e){return e&&this.on("close",e,this),this},afterClose:function(e){return e&&this.on("afterClose",e,this),this},afterOpen:function(e){return e&&this.on("afterOpen",e,this),this},isOpen:function(){return this._isOpen},close:function(){return this._isOpen?this.fire("close",g)?(h.remove(),this._isOpen=!1,m=null,this.fire("afterClose",g),this):this:this},open:function(e,t,r){return this.fire("open",g)?(m&&m!==this&&m.close(),m=this,this.undelegate(),t&&this.delegate(t),e&&!n.isHtml(e)&&(e=n.format(o,e)),p.html(e||""),this._title&&d.html(this._title),this._width&&h.width(this._width),this._height&&h.height(this._height),h.css("position",!this._fixed||!c?"absolute":"fixed"),this.pos(),h.show(),this._isOpen=!0,r&&r.call(this,p),this.fire("afterOpen",g),this):this},delegate:function(e){if(!e.length){p.delegate(e.selector,e.event,e.func);return}return n.each(e,function(e){this.delegate(e.selector,e.event,e.func)},p),this},undelegate:function(){return p.undelegate(),this},pos:function(){return y(!this._fixed||!c),this},title:function(e){return this._title=e,this._isOpen&&d.html(e),this},width:function(e){return this._width=e,this._isOpen&&(h.width(e),this.pos()),this},height:function(e){return this._height=e,this._isOpen&&(h.height(e),this.pos()),this},pin:function(){if(this._fixed||!c)return;return this._fixed=!0,this._isOpen&&(h.css("position","fixed"),this.pos()),this},unpin:function(){if(!this._fixed)return;return this._fixed=!1,this._isOpen&&(h.css("position","absolute"),this.pos()),this},showCover:function(e,t){v=$('<div id="blockCover" style="position:fixed;top:0;left:0;right:0;bottom:0;display:none;z-index:'+((parseInt(h.css("z-index"),10)||0)-1)+';"></div>').appendTo("body");var n=this;return this.on("afterClose",function(){w()}).on("afterOpen",function(){b(n._coverOpacity,n._coverColor)}),typeof e=="string"&&(t=e,e=null),e&&(this._coverOpacity=e),t&&(this._coverColor=t),b(e||this._coverOpacity,t||this._coverColor),this},hideCover:function(){return w(),this}},t.extend(T),T}),define("lib/tmpl",[],function(){function e(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}var t={entities:e};return function(n,r){/\W/.test(n)||(n=document.getElementById(n).innerHTML);var i=new Function("funcs, obj","var p=[],print=function(){p.push.apply(p,arguments);};with(funcs){with(obj){p.push('"+n.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',entities($1),'").replace(/\t:=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}}return p.join('');");return r?i(t,r):function(e){return i(t,e)}}}),function(){function n(e){this.message=e}var e=typeof exports!="undefined"?exports:this,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.prototype=new Error,n.prototype.name="InvalidCharacterError",e.btoa||(e.btoa=function(e){var r=String(e);for(var i,s,o=0,u=t,a="";r.charAt(o|0)||(u="=",o%1);a+=u.charAt(63&i>>8-o%1*8)){s=r.charCodeAt(o+=.75);if(s>255)throw new n("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");i=i<<8|s}return a}),e.atob||(e.atob=function(e){var r=String(e).replace(/=+$/,"");if(r.length%4==1)throw new n("'atob' failed: The string to be decoded is not correctly encoded.");for(var i=0,s,o,u=0,a="";o=r.charAt(u++);~o&&(s=i%4?s*64+o:o,i++%4)?a+=String.fromCharCode(255&s>>(-2*i&6)):0)o=t.indexOf(o);return a})}(),define("Base64",function(){}),function(e){"use strict";function a(e){var t=0,n;for(n=0;n<e.length;n++)t=e.charCodeAt(n)+(t<<6)+(t<<16)-t<<0;return t}function f(){return e.devicePixelRatio||1}function l(e,t,n,r){var i,s,o,u="",f=e.length;t=t.replace(/^\/+/,""),f>1?(s=a(t)%f,s<0&&(s+=3),o=e[s]):o=e[0],i="http://"+o+"/"+encodeURI(t);if(n&&r)u+="/1";else if(n||r)u+="/3";return n&&(u+="/w/"+n),r&&(u+="/h/"+r),u!==""&&(i=i+"?imageView2"+u),i}function c(e){return e.indexOf("dev.guokr.com")>0}function h(e,t,n){var s,a,f,h,p=r.createElement("a"),d=c(e)?o:u;p.href=e,h=p.pathname;if(h.indexOf("/image/")===0)h=h.slice(7);else if(h.indexOf("image/")===0)h=h.slice(6);else if(h.indexOf("/thumbnail/")===0||h.indexOf("thumbnail/")===0)f=e.replace(i,"$2"),s=f.slice(-2),a={dJ:".gif",pQ:".jpg",BO:".png"}[s],h=f+a;return l(d,h,t,n)}function p(e,t,r){var o={src:e,width:null,height:null,"data-hashkey":null,"data-orig-width":null,"data-orig-height":null};if(!i.test(e))return s.test(e)&&(o.src=h(e)),o;o.src=e=h(e);var u=f(),a=e.replace(i,"$2"),l=n(a.replace(/_/g,"/").replace(/-/g,"+")),c=l.charCodeAt(32)+l.charCodeAt(33)*256+l.charCodeAt(34)*65536+l.charCodeAt(35)*16777216,p=l.charCodeAt(36)+l.charCodeAt(37)*256+l.charCodeAt(38)*65536+l.charCodeAt(39)*16777216;o["data-hashkey"]=a,o["data-orig-width"]=c,o["data-orig-height"]=p;if(t===undefined&&r>0)t=r*c/p;else if(r===undefined&&t>0)r=t*p/c;else if(t<1||r<1)return o;if(c<t*u||p<r*u)u=1,c>t&&p>r?u=Math.min(c/t,p/r):(t=c>t?t:c,r=p>r?r:p);o.width=Math.round(t),o.height=Math.round(r),t=Math.round(t*u),r=Math.round(r*u);if(Math.abs(c-t)>1||Math.abs(p-r)>1)o.src=h(e,t,r);return o}function d(e){if(i.test(e)||s.test(e))e=h(e);return e}var t,n=e.atob||require("Base64").atob,r=e.document||require("jsdom").jsdom(),i=/^http:\/\/(img1\.(?:\w+\.)?guokr\.com(?:\:\d+)?\/(?:image|thumbnail)|\d+\.im(?:\.dev)?\.guokr\.com(?:\:\d+)?)\/([\w-]{56})(?:_\d*x\d*)?\.(jpg|png|gif)(\?.*|$)/,s=/^(http:\/\/(?:\w+\.)*guokr\.com(?:\:\d+)?)?(\/gkimage\/[a-z0-9\/]{15}\.(gif|jpe?g|png))(\?.*|$)/,o=["1.im.dev.guokr.com","2.im.dev.guokr.com","3.im.dev.guokr.com"],u=["1.im.guokr.com","2.im.guokr.com","3.im.guokr.com"];t={sdbm:a,thumbnail:p,original:d,public_url:h},typeof define=="function"&&define.amd?define("lib/gkimage",["Base64"],function(){return t}):typeof e!="undefined"?(typeof module!="undefined"&&module.exports&&(e=module.exports=t),e.gkimage=t):window.gkimage=t}(typeof exports=="object"&&exports||this),define("lib/gbbcode",["jquery","lib/gkimage"],function(t,n){"use strict";function u(e){return/www\.tudou\.com/.test(e)?e+="&autoPlay=true":/www\.56\.com/.test(e)?e+="?auto=1":/player\.video\.qiyi\.com/.test(e)&&(e+="-autoPlay=1"),e}function a(e){var r=/src="[^"]+"/;e.each(function(){var e,r,i,s,o,u=t(this),a=u.parents(".gbbcode-content"),f=u.data("image"),l=t("<img>");u.replaceWith(l),i=l.css("max-width"),i!==null&&i.slice(-2)==="px"?i=parseInt(i):i=a.width(),s=i,o=l.parent(),o.css("display")==="block"&&(s=o.width()||s),r=Math.min(i,s),e=n.thumbnail(f,r),e.width===null?l.attr("src",e.src):l.attr(e)})}function f(e){e.each(function(){var e=t(this);e.attr("src",e.attr("src").replace(/\.svg$/,".png"))})}function l(e,r){var s=[];e.each(function(){var e=t(this).data("video-loaded"),n=t(this).data("video");e!==!0&&s.indexOf(n)<0&&s.push(n)});if(s.length===0)return;t.ajax({url:"/apis/shortener/url.json",type:"post",data:{url:s},dataType:"json",traditional:!0,success:function(o){if(!o.ok)return;s=[],e.each(function(){var e=t(this),r=e.parents(".gbbcode-content"),s=e.data("video"),a=o.result[s].extradata,f=o.result[s].urltype,l=e.width(),c=e.height();if(!a||a.player_type===undefined)return;var h,p,d=a.preview_image,v=u(a.player_url),m=a.player_type,g=a.title+" - "+f.title,y=n.thumbnail(d,l,c);e.attr("title",g).css("background-image","url("+y.src+")").bind("click touch",function(n){var s,o;if(m==="flash"&&i===!1){e.attr("target","_blank");return}n.preventDefault(),e.css("display","none"),p===undefined?p=t('<a data-collapsed href="javascript: void(0)">↑ 收起</a>').data("collapsed",!1).insertAfter(e).bind("click touch",function(t){t.preventDefault();if(p.data("collapsed")===!0)return;h.remove(),h=undefined,e.css("display","block"),p.css("display","none").data("collapsed",!0)}):p.css("display","block").data("collapsed",!1);if(h!==undefined)return;h=t("<iframe>").attr({src:v,frameborder:0,allowfullscreen:!0}).insertAfter(e),o=h.css("max-width"),o!==null&&o.slice(-2)==="px"?o=parseInt(o):o=r.width(),s=Math.min(o,h.parent().width()||o),h.attr({width:s,height:s*9/12})}).data("video-loaded",!0)}),r instanceof Function&&r()}})}function c(e){e.each(function(){var e=t(this);e.bind("load",function(){e.height(e.contents().find("body").height()+50)}),e.height(e.contents().find("body").height()+50)})}var r=document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Shape","1.0")||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Shape","1.1"),i=!1;try{var s=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");s&&(i=!0)}catch(o){navigator.mimeTypes&&navigator.mimeTypes["application/x-shockwave-flash"]!==undefined&&navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin&&(i=!0)}return function(e){e===undefined&&(e={}),e.imageSelector=e.imageSelector||"noscript[data-image]",e.videoSelector=e.videoSelector||"a[data-video]",e.mathSelector=e.mathSelector||"img[data-math]",e.pollSelector=e.pollSelector||"iframe[data-poll]",a(t(e.imageSelector)),l(t(e.videoSelector)),c(t(e.pollSelector)),r!==!0&&f(t(e.mathSelector))}}),define("lib/cookies",{get:function(e){"use strict";if(document.cookie.length>0){var t,n=document.cookie.indexOf(e+"=");if(n!=-1)return n=n+e.length+1,t=document.cookie.indexOf(";",n),t==-1&&(t=document.cookie.length),unescape(document.cookie.substring(n,t))}return""},set:function(e,t,n,r){"use strict";return document.cookie=e+"="+escape(t)+(n==null?"":";expires="+n.toGMTString())+";path="+(r||"/"),this},remove:function(e,t){"use strict";var n=new Date;n.setTime(n.getTime()-1);var r=this.get(e);r!=null&&(document.cookie=e+"="+r+";expires="+n.toGMTString()+";path="+(t||"/"))}}),define("lib/accessToken",["lib/cookies"],function(e){"use strict";var t,n=window.location.host,r=window.url_re_signin||"",i=window.client_id||32353;return t=e.get("_"+i+"_access_token"),{checkToken:function(){return typeof t=="string"?!0:!1},getToken:function(){return t}}}),require(["lib/m","lib/user","lib/Overlay","lib/tmpl","lib/gbbcode","lib/cookies","lib/accessToken"],function(e,t,n,r,i,s,o){"use strict";function d(){m.hide(),m.eq(v).show().animate({top:"-50px"},1e3),v==m.length-1?v=0:v++,m.eq(v).css("top","50px").show().animate({top:"0px"},1e3)}function g(){var e="";return $.ajaxSettings.async=!1,$.getJSON("/apis/academy/speech_tag.json",function(t){if(t.ok){var n=t.result,i='<a class="info-tag" data-id = <%=id%> href="javascript:void(0)"><%=label%></a>';$.each(n,function(t,n){e+=r(i,{label:n.name,id:n.id})})}else $(".video-error").css("display","block"),$(".video-error").html("视频添加错误")}),e}function y(){$(".info-tag").click(function(){var e=$(this),t=$(this).data("id");if(c<5)if(e.attr("class")=="info-tag")e.addClass("active"),l.push(t),c++;else{e.removeClass("active");for(var n=0;n<l.length;n++)l[n]==t&&(l.splice(n,1),c--)}else if(e.attr("class")=="info-tag")alert("最多选择5个标签哦→_→");else{e.removeClass("active");for(var n=0;n<l.length;n++)l[n]==t&&(l.splice(n,1),c--)}})}function b(){var e=g(),t='<div class="block">		                    <div class="block-title">添加新的演讲</div>			                    <div class="block-content">				        			<input class="video-url" placeholder="请输入链接地址"></input>				        			<span class="video-loading">视频上传中...</span>				        			<span class="video-error">这个演讲视频已经存在了，换个分享呗～</span>				        			<input maxlength = "30" placeholder="题目最多可显示30个字符" class="video-title"></input>							       	<div class="video-pic">								       	<h1>封面图片</h1>								       	<img src="">							       	</div>				        			<div class="info-wrap">				        				<h1 class="tag-title">标签</h1>'+e+'</div>									<div class="submit-btn">										<a class="video-submit" href="javascript:void(0)">发表</a>										<a class="video-cancle" href="javascript:void(0)">取消</a>				        			</div>				        		</div>			                </div>		                </div>';a=new n("","","","lecture"),a.title("").width(p).open(t).showCover(.8,"#fff"),y()}var u=$("#addVideo"),a,f=o.getToken(),l=[],c=0,h=$(window).width(),p=640;if(h<768)p=h*.95;else{var v=0,m=$(".float-tips li");m.eq(0).show(),setInterval(d,5e3),$(".lecture-list li").hover(function(){var e=$(this);e.find(".up-info").stop().animate({marginTop:"6px"},300),e.find(".view-info").hide(),e.find(".hidden-info").stop().fadeIn(300)},function(){var e=$(this);e.find(".up-info").stop().animate({marginTop:"20px"},300),e.find(".hidden-info").hide(),e.find(".view-info").stop().fadeIn(300)})}var w={login:function(){$(".estimate a").bind("click tap",function(){var e=$(this),t=e.parents("li").data("id"),n=e.parents("li").data("like"),r=0,i={access_token:f,speech_id:t,like:0};e.attr("class").substring(4)=="active"?e.removeClass("active"):e.addClass("active");if(e.attr("class").substring(0,3)=="sup")switch(n){case-1:i.like=1,r=2;break;case 0:i.like=1,r=1;break;case 1:i.like=0,r=-1;break;default:}else switch(n){case-1:i.like=0,r=1;break;case 0:i.like=-1,r=-1;break;case 1:i.like=-1,r=-2;break;default:}var s=e.parents(".estimate").children("span");e.parents(".estimate").children("a").removeClass("active"),e.parents("li").data("like",i.like),s.html(parseInt(s.html())+r);switch(i.like){case-1:e.parents(".estimate").children(".opp").addClass("active");break;case 1:e.parents(".estimate").children(".sup").addClass("active");break;default:}$.ajax({url:"/apis/academy/speech_recommend.json",type:"post",data:i,async:!1,dataType:"json",success:function(e){console.log(e)},error:function(e){$(".video-error").css("display","block"),$(".video-error").html("视频添加错误")}})}),u.bind("click",function(){b();var e=$(".video-url");e.blur(function(){var t=e[0].value;$(".video-error").css("display","none"),t&&($(".video-loading").css("display","block"),$.ajax({url:"/apis/academy/speech_crawl.json",type:"post",data:{speech_url:t,access_token:f},async:!1,dataType:"json",success:function(e){$(".video-loading").hide();var n=e.result,r=n.source,i=n.link;if(n){var s=n.cover,o=n.title;$(".video-title").show(),$(".video-title").attr("value",o),$(".video-pic").show(),$(".video-pic img").attr("src",s),$(".video-submit").css("background-color","#1caaea"),$(".video-submit").css("cursor","pointer"),$(".video-submit").click(function(){$.ajax({url:"/apis/academy/speech.json",type:"post",data:{title:$("input.video-title").val(),link:i,cover:s,tags:l.toString(),source:r,access_token:f,origin:t},async:!1,dataType:"json",success:function(e){var t=e.result,n=t.redirect_to;a.close(),setTimeout(function(){window.location.href=n},100)},error:function(e){var t=$.parseJSON(e.responseText);t.error_code=="289001"?$(".video-loading").css("display","none"):($(".video-error").css("display","block"),$(".video-error").html("视频添加错误"))}})})}},error:function(e){var t=$.parseJSON(e.responseText);t.error_code=="289002"?($(".video-loading").css("display","none"),$(".video-error").css("display","block")):t.error_code=="289005"?($(".video-loading").css("display","none"),$(".video-error").css("display","block").html('这个演讲视频已经存在了哦，点击跳转：<a href="'+t.error+'" target="_blank">'+t.error+"</a>")):($(".video-error").css("display","block"),$(".video-error").html("视频添加错误"))}}))}),$(".video-cancle").click(function(){a.close()})});var e=window.innerWidth,t=window.innerHeight,n=$("#seenOverlay");n.css({top:t/2-85,left:e/2-150}),$(".seen,.skip").click(function(){var e=$(this),t=e.parents("li"),r=t.data("id"),i=e.attr("class"),s="/apis/academy/speech_"+i+".json";$.ajax({url:s,type:"POST",data:{access_token:f,speech_id:r},dataType:"json",success:function(e){e.ok&&(t.slideUp(),i=="seen"&&n.show().delay(2e3).fadeOut(400))}})})},unlogin:function(){$(".lecture-wrap").delegate(".estimate a, #addVideo, .seen, .skip","click",function(e){e.preventDefault();var n=document.body.clientWidth<768?url_signin_mobile:url_signin;t.toLogin(n)})}},E=t.isLogin()?"login":"unlogin";w[E]&&w[E](ukey),w.all&&w.all()}),define("lectureList",function(){})})();